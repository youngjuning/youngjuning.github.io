---
title: å‰ç«¯ç»„ä»¶åŒ–å®æˆ˜ä¹‹ Button
date: 2023-03-03 10:36:18
categories:
  - [å‰ç«¯, ç»„ä»¶åŒ–]
tags:
  - å‰ç«¯
  - ç»„ä»¶åŒ–
  - ç»„ä»¶åº“
  - React Native
cover: https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b79b60e52f9b4e199372d26724e81a59~tplv-k3u1fbpfcp-zoom-crop-mark:1512:1512:1512:851.awebp
---

> âš ï¸æœ¬æ–‡ä¸ºæ˜é‡‘ç¤¾åŒºé¦–å‘ç­¾çº¦æ–‡ç« ï¼Œæœªè·æˆæƒç¦æ­¢è½¬è½½

> å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯[ç´«ç«¹ğŸ‹](https://youngjuning.js.org)ï¼Œä¸€åªä½åœ¨æ­åŸçš„æœ¨ç³»å‰ç«¯ğŸ§šğŸ»â€â™€ï¸ï¼Œå¦‚æœä½ å–œæ¬¢æˆ‘çš„æ–‡ç« ğŸ“šï¼Œå¯ä»¥é€šè¿‡ç‚¹èµå¸®æˆ‘èšé›†çµåŠ›â­ï¸ã€‚

<ins class="adsbygoogle" style="display:block; text-align:center;"  data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-7962287588031867" data-ad-slot="2542544532"></ins><script> (adsbygoogle = window.adsbygoogle || []).push({});</script>

## å‰è¨€

åœ¨ [ã€Šæ¯ä¸ªå‰ç«¯éƒ½åº”è¯¥æ‹¥æœ‰è‡ªå·±çš„ç»„ä»¶åº“,å°±åƒæ¯ä¸ªå¤å¤©éƒ½æœ‰è¥¿ç“œğŸ‰ã€‹](https://juejin.cn/post/6983854006124675108) ä¸€æ–‡ä¸­ï¼Œç´«ç«¹å¸¦é¢†å°é»‘ä»é›¶æ­å»ºäº†ä¸€ä¸ªç»„ä»¶åº“é¡¹ç›®ï¼Œå®Œæˆäº†é¡¹ç›®ç»“æ„ã€æ„å»ºã€æµ‹è¯•ã€æ–‡æ¡£ç­‰åŸºç¡€å·¥ç¨‹åŒ–å·¥ä½œå¹¶å®Œæˆäº†ç¬¬ä¸€ä¸ªç»„ä»¶ Iconã€‚æœ¬æœŸå»¶ç»­ä¸ŠæœŸçš„ç»„ä»¶å·¥ç¨‹åŒ–çš„ä¸»é¢˜ï¼Œå¤æ—¥ç‚çƒ­ï¼Œç‚¹ä¸Šä¸€æ¯æ¨æç”˜éœ²ï¼Œå’Œç´«ç«¹èµ´ä¸€åœº Button å¼€å‘ä¹‹çº¦å§ã€‚èµ´çº¦åï¼Œä½ å°†ä¼šæ”¶è·ä»¥ä¸‹çš„å†…å®¹ï¼š

![ç´«ç«¹](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/58285f3cce144972b2ccb88e11efd73f~tplv-k3u1fbpfcp-zoom-1.image)

> PSï¼šé…åˆ[ä»“åº“](https://github.com/youngjuning/vant-react-native)å’Œ[ç»„ä»¶åº“æ–‡æ¡£](https://vant-react-native.js.org/)é˜…è¯»æœ¬æ–‡æ•ˆæœæ›´ä½³å–²ï¼

## Button ä¸è®¾è®¡å¿ƒç†å­¦

ä½œä¸ºå‰ç«¯å·¥ç¨‹å¸ˆï¼Œå…¥è¡Œè‡³ä»Šæ¥è§¦æœ€å¤šçš„å°±æ˜¯è®¾è®¡å¸ˆäº†ã€‚è€³æ¿¡ç›®æŸ“ä¸‹è™½è¯´æ²¡å­¦ä¼šä»€ä¹ˆè®¾è®¡å·¥å…·ï¼Œä½†æ˜¯å¯¹è®¾è®¡ä¸äººçš„å¿ƒç†æœ‰äº†ä¸€å®šè®¤è¯†ã€‚

ç´«ç«¹è®¤ä¸ºä»»ä½•äº‹ç‰©éƒ½ä¸å¯èƒ½å‡­ç©ºå‡ºç°ï¼Œè‡ªæœ‰å…¶ä¼ æ‰¿ã€‚ä½¿ç”¨å¹¿æ³›çš„åŸºç¡€ç•Œé¢å…ƒç´  Button ä¹Ÿä¸ä¾‹å¤–ï¼Œæˆ‘ä»¬ç”Ÿæ´»ä¸­å°±æœ‰éšå¤„å¯è§çš„æŒ‰é’®ã€‚ä¸¾ä¸ªæ —å­ğŸŒ°ï¼Œæ¯å¤©ä¸Šç­ä¸‹ç­å¿…ç„¶è¦æŒ‰çš„ç”µæ¢¯æŒ‰é’®ã€æ‰‹æœºéŸ³é‡æŒ‰é’®ã€å°ç±³ 9 é¸¡è‚‹çš„å°çˆ±åŒå­¦å”¤èµ·æŒ‰é’®ã€‚è¦ææ¸…æ¥šä¸ºä»€ä¹ˆéœ€è¦æŒ‰é’®ï¼Œæˆ‘ä»¬æœ‰å¿…è¦æ¢ç©¶ä¸‹ç”Ÿæ´»ä¸­è¿™äº›æŒ‰é’®çš„ä½œç”¨ã€‚

### ç‚¹ä¸€ä¸‹æŒ‰é’®çš„å¿«æ„Ÿ

æƒ³è±¡ä¸€ä¸‹æŠŠé”®ç›˜æŒ‰é”®æ¢æˆè§¦æ‘¸å±ï¼Œä½ æœ€åœ¨ä¹çš„ä¸€å®šæ˜¯å®Œç¾è¿˜åŸç‰©ç†é”®çš„æ•²å‡»æ„Ÿï¼Œåƒç´«ç«¹ç”¨æ‰‹æœºè™šæ‹Ÿé”®ç›˜å°±å–œæ¬¢è®¾ç½®æŒ‰é”®éœ‡åŠ¨å’ŒéŸ³æ•ˆã€‚é€šè¿‡æ‰“å‡»ï¼ˆç‚¹å‡»ï¼‰è·å¾—å¿«æ„Ÿæ˜¯è¾ƒä¸ºæ™®éçš„äººæ€§ã€‚æŒ‰é’®åœ¨æŒ‰ä¸‹ã€æ¾å¼€æ—¶æœ‰ä¸°å¯Œçš„è´¨æ„Ÿå’Œäº¤äº’æ„Ÿï¼Œå®Œç¾æ»¡è¶³äº†äººä»¬ç‚¹ä¸€ä¸‹çš„å¿«æ„Ÿã€‚

![ç´«ç«¹](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/542a6bbb880e4594ae384ee0bd1e511d~tplv-k3u1fbpfcp-watermark.image)

### ç°å®çš„å®ç”¨æ€§

ä» BB æœºåˆ°è¯ºåŸºäºšå†åˆ°å¦‚ä»Šçš„æ™ºèƒ½æœºï¼Œå®ä½“æŒ‰é’®å‰Šå‡åˆ°åªå‰©ä¸‹éŸ³é‡é”®å’Œå¼€å…³æœºé”®ã€‚æŒ‰é”®è™½ç„¶å…‰ç§ƒç§ƒæ²¡æœ‰ä»»ä½•æ ‡è¯†ï¼Œä½†æˆ‘ä»¬å°±æ˜¯çŸ¥é“å®ƒçš„åŠŸèƒ½ã€‚è¯•æƒ³ä¸€ä¸‹æ²¡æœ‰è¿™ä¸ªæ¥è‡ªè¿œå¤æ—¶ä»£çš„å¼€å…³é”®ï¼Œä½ æ‰‹é‡Œçš„æ‰‹æœºå°±æ˜¯ä¸€å—æ¿ç –ã€‚

### ç–¯ç‹‚æš—ç¤ºç”¨æˆ·ï¼Œè¾¾åˆ°ä¸å¯å‘Šäººç›®çš„

å°ç±³ 9 å•ç‹¬å”¤èµ·å°çˆ±åŒå­¦çš„æŒ‰é”®ç»å¸¸ä¼šè¢«è¯¯æŒ‰ï¼Œä¹‹å‰æˆ‘è¿˜ä¸ç†è§£è¿™ä¹ˆè ¢çš„è®¾è®¡çš„ç›®çš„ã€‚åœ¨ç®€å•ç ”ç©¶äº†ç‚¹è®¾è®¡å¿ƒç†å­¦æˆ‘æ˜ç™½äº†ã€‚å°çˆ±çš„è®¾è®¡è€…ä¸ºäº† äº§å“æ—¥æ´»å’Œ AI è®­ç»ƒå°±æ˜¯æ•…æ„è¿™ä¸ªè®¾è®¡çš„ã€‚

å°ç±³ 10 è™½ç„¶ç§»é™¤äº†å•ç‹¬çš„å”¤èµ·é”®ï¼Œå´æŠŠåŸæ¥çš„ç”µæºé”®æ”¹æˆäº†ä¸€é”®å¤šç”¨ã€‚æ¯æ¬¡æƒ³è¦é‡å¯æ‰‹æœºè¿˜å¾—å…ˆå”¤èµ·ä¸€ä¸‹å°çˆ±åŒå­¦ã€‚ä¸å¾—ä¸è¯´ï¼Œå°çˆ±åŒå­¦å°ç±³äº²å¥³å„¿ã€‚

![ç´«ç«¹](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/633381b8c2c342ed94bf024dbc19cf76~tplv-k3u1fbpfcp-watermark.image)

åæ§½å½’åæ§½ï¼Œå°ç±³è¿™ä¸ªæŒ‰é’®ç¡®å®èµ·åˆ°äº†åŸ¹å…»ç”¨æˆ·ä¹ æƒ¯çš„ä»»åŠ¡ã€‚å½“ç”¨æˆ·çŸ¥æ‚‰æŸä¸ªæŒ‰é’®èƒ½æŒ‡å‘æŸä¸ªæ“ä½œï¼Œæˆ–è€…è·å–æŸç±»ä¿¡æ¯åï¼Œé•¿æ­¤ä»¥å¾€ç”¨æˆ·å°±ä¼šå½¢æˆä½¿ç”¨ä¹ æƒ¯ã€‚å¦‚æœæŸæ“ä½œèƒ½å¤Ÿä¸ºç”¨æˆ·å’Œå‚å•†æŒç»­å¸¦æ¥ä»·å€¼ï¼Œé‚£å°±å¯ä»¥è®©æŒ‰é’®çš„ä½ç½®æ›´åŠ é†’ç›®ï¼ŒæŒç»­åŸ¹å…»ç”¨æˆ·ç‚¹å‡»ä¹ æƒ¯ã€‚

### æŒ‡å¼•ç”¨æˆ·æ“ä½œ

è¿™ä¸ªåœ¨ Web å¼€å‘ä¸­æ˜¯æœ€å¸¸è§çš„ä½¿ç”¨åœºæ™¯ï¼Œæ¯ä¸ªå¯äº¤äº’é¡µé¢ä¸Šéƒ½æœ‰è¿™ç±»æŒ‰é’®çš„å‡ºç°ï¼Œç”¨æ¥æŒ‡å¼•ç”¨æˆ·ä¸‹ä¸€æ­¥è¯¥æ€ä¹ˆåšã€‚æ¯”å¦‚è¡¨å•çš„æäº¤å’Œé‡ç½®ã€‚

![ç´«ç«¹](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d2c2a8abbe84471f96a67e18196c53fb~tplv-k3u1fbpfcp-watermark.image)

è™½ç„¶æŒ‰é’®ä¹Ÿå¸¸ä½œä¸ºè¡¨å•å…ƒç´ ï¼Œä½†æ˜¯åŒºåˆ«äºå…¶ä»–è¡¨å•å…ƒç´ ï¼ŒæŒ‰é’®å› å…¶å¤©ç„¶åœ°è‡ªè¯´æ˜æ€§ï¼Œä¸éœ€è¦ Label å¯¹å…¶è¿›è¡Œè¾…åŠ©è¯´æ˜ï¼Œå•°å—¦è¿™ä¹ˆå¤šï¼Œæ˜å‹ä»¬åº”è¯¥åœ¨çœ‹åˆ°ä¸€ä¸ªæŒ‰é’®æ—¶ï¼Œåº”è¯¥ä¹Ÿä¼šæœ‰ä»è®¾è®¡ä¸Šå“é‰´çš„æ„è¯†äº†ï¼Œæ¬¢è¿å°†å¯¹ä¸‹å›¾çš„å“é‰´åœ¨è¯„è®ºåŒºå‘Šè¯‰ç´«ç«¹ã€‚

![ç´«ç«¹](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/88c6754b28984fc3866319c35790fc03~tplv-k3u1fbpfcp-watermark.image)

## ç»„ä»¶ä¸»é¢˜åŒ–

åœ¨å¼€å§‹å¼€å‘å…·ä½“ç»„ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆçº¦å®šå¥½ç»„ä»¶ä¸»é¢˜åŒ–çš„è§„èŒƒã€‚ä¹‹å‰ antd-mobile-rn å°±å› ä¸ºè®¾è®¡é—®é¢˜ï¼Œä¸­é€”èŠ±è´¹å¤§åŠ›æ°”é‡æ„ã€‚å‡ ä¹æ‰€æœ‰çš„ç»„ä»¶åº“éƒ½ä¼šå°†è‰²å½©ã€å¸ƒå±€è¿™äº›ä»¥ css å˜é‡çš„å½¢å¼æä¾›ç»™ä½¿ç”¨è€…å’Œå¼€å‘è€…ä¸ºï¼ŒReact Native ä¸åŒçš„æ˜¯æ ·å¼åŸºäº CSS in JSï¼Œä¸è¿‡é“ç†ç›¸é€šï¼Œå‚ç…§ vant çš„[è®¾è®¡èµ„æº](https://github.com/youzan/vant/blob/dev/src/style/var.less)ï¼Œæˆ‘ä»¬æŠ½å‡ºäº†ä¸€å¥— JavaScript å¸¸é‡ï¼š

```ts
// packages/themes
export interface Theme {
  'animation-duration-base': string;
  'animation-duration-fast': string;
  'animation-timing-function-enter': string;
  'animation-timing-function-leave': string;
  'font-size-xs': number;
  'font-size-sm': number;
  'font-size-md': number;
  'font-size-lg': number;
  'font-weight-bold': number;
  // å˜é‡è¿‡å¤šï¼Œè¿™é‡Œä»…å±•ç¤ºéƒ¨åˆ†å˜é‡
}
```

æœ‰äº†è¿™äº› JS å¸¸é‡ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¾è®¡ä¸»é¢˜ç³»ç»Ÿã€‚åŸºäº CSS in JS çš„ä¸»é¢˜åŒ–è®¾è®¡ä¸€èˆ¬æ˜¯åŸºäº React Context å®ç°ï¼Œéœ€è¦æä¾› ThemeProvider ä¼ å…¥ä¸»é¢˜ä¸Šä¸‹æ–‡ï¼ŒThemeConsumerã€WithThemeï¼ˆé«˜é˜¶ç±»ç»„ä»¶ï¼‰ã€withThemeï¼ˆé«˜é˜¶å‡½æ•°ç»„ä»¶ï¼‰ æˆ– useThemeï¼ˆReact Hooksï¼‰ä½œä¸ºæ¶ˆè´¹è€…è·å–ä¸Šä¸‹æ–‡ã€‚è‡ªå·±å®ç°ä¹Ÿä¸éš¾ï¼Œä¸è¿‡æ›´æ–‡ä»»åŠ¡æ¯”è¾ƒç´§æ€¥ï¼Œæˆ‘ä»¬å…ˆåŸºäº [cssinjs/theming](https://github.com/cssinjs/theming) å®ç°åŠŸèƒ½ï¼ŒåæœŸæœ‰éœ€è¦å†å›æ¥é€ è½®å­ä¹Ÿä¸è¿Ÿã€‚ä¸‹é¢ğŸ‘‡å°±æ˜¯æˆ‘ä»¬åŸºäº theming çš„ `createTheming` å‡½æ•°åˆ›å»ºè‡ªå®šä¹‰ä¸»é¢˜ä¸Šä¸‹æ–‡ã€‚

```ts
import { createTheming } from 'theming';
const context = React.createContext(defaultTheme);
const theming = createTheming(context);

export const { ThemeProvider, withTheme, useTheme } = theming;
```

> ä¸»é¢˜åŠŸèƒ½æ˜¯é€šç”¨çš„ï¼Œå› æ­¤æˆ‘å°†ä¸»é¢˜ç›¸å…³çš„èƒ½åŠ›éƒ½æ”¾åœ¨ `@vant-react-native/theme` åŒ…ä¸­å‘å¸ƒã€‚

## Button çš„å®ç°

React Native å†…ç½®çš„ Button ç»„ä»¶çš„æ ·å¼æ˜¯å›ºå®šçš„ï¼Œåªèƒ½è¿›è¡Œä¸€äº›ç®€å•çš„è®¾ç½®ã€‚ä¸”å†…ç½®çš„ Button ç»„ä»¶åœ¨ Android å’Œ ios ä¸¤ä¸ªå¹³å°ä¸Šçš„è¡¨ç°å¹¶ä¸ä¸€è‡´ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ ¹æ®æ›´åº•å±‚çš„ç»„ä»¶è¿›è¡Œå°è£…ã€‚æˆ‘ä»¬å¯¹æ¯” ant-design-mobile-rn å’Œ react-native-elements åé‡‡ç”¨äº†å‰è€…ä½¿ç”¨çš„ `TouchableHighlight` ç»„ä»¶ã€‚ç”±äºç»§æ‰¿è‡ª TouchableHighlightï¼Œæ‰€ä»¥æˆ‘ä»¬ç»„ä»¶çš„ Props ç±»å‹å¦‚ä¸‹ï¼š

```ts
import { TouchableHighlightProps } from 'react-native';
interface ButtonProps extends TouchableHighlightProps {
}
```

### æŒ‰é’®ç±»å‹

vant çš„ [Button](https://youzan.github.io/vant/#/zh-CN/button#an-niu-lei-xing) æ”¯æŒ `default`ã€`primary`ã€`info`ã€`warning`ã€`danger` äº”ç§ç±»å‹ï¼Œé»˜è®¤ä¸º `default`ã€‚ç°åœ¨ï¼Œç»„ä»¶çš„åŸºæœ¬å®šä¹‰å¦‚ä¸‹ï¼š

```ts
// ...
import React, { FunctionComponent } from 'react';
import { Text, View } from 'react-native';

interface ButtonProps {
  type?: 'default' | 'primary' | 'info' | 'warning' | 'danger';
}

const Button: FunctionComponent<ButtonProps> = props => {
  // ...
};
// ...
```

æˆ‘ä»¬çš„ç»„ä»¶ä¸ºäº†é€‚åº”ä¸»é¢˜åŒ–éœ€æ±‚ï¼Œæ ·å¼ä¸èƒ½æ˜¯å†™æ­»åœ¨ç»„ä»¶é‡Œçš„ï¼Œè€Œæ˜¯è¦é€šè¿‡ä¸Šä¸‹æ–‡è·å–æ ·å¼å¸¸é‡ã€‚æˆ‘ä»¬æ€è·¯æ˜¯é¦–å…ˆä½¿ç”¨ `useTheme` ä»ä¸Šä¸‹æ–‡ä¸­è·å–ä¸»é¢˜ï¼Œç„¶åç”±äºæ ·å¼å®šä¹‰è¾ƒå¤šï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªç»„ä»¶ç¼–å†™ä¸€ä¸ª `useStyle` hook æ”¾åœ¨å•ç‹¬çš„ style.ts æ–‡ä»¶ä¸­ï¼š

```ts
import { StyleSheet } from 'react-native';
import { Theme, useTheme } from '@vant-react-native/theme';

export const useStyle = props => {
  const theme = useTheme<Theme>();

  const getBackgroundColor = () => {
    switch (props.type) {
      case 'primary':
        return theme['success-color'];
      case 'info':
        return theme['primary-color'];
      case 'warning':
        return theme['warning-color'];
      case 'danger':
        return theme['danger-color'];
      default:
        return theme.white;
    }
  };

  const getTextColor = () => {
    if (props.type === 'default') {
      return theme.black;
    } else {
      return theme.white;
    }
  };

  const getBorderRadius = () => {
    if (props.round) {
      return theme['border-radius-max'];
    }
    if (props.square) {
      return 0;
    }
    return theme['border-radius-sm'];
  };

  const styles = StyleSheet.create({
    container: {
      alignItems: 'center',
      backgroundColor: getBackgroundColor(),
      borderColor: getBorderColor(),
      borderRadius: theme['border-radius-sm'],
      borderWidth: theme['border-width-base'],
      flexDirection: 'row',
      flex: 1,
      justifyContent: 'center',
      opacity: 1,
      paddingHorizontal: 15,
    },
    indicator: {
      marginRight: theme['padding-xs'],
    },
    textStyle: {
      color: getTextColor(),
      fontSize: 14,
    },
    wrapper: {
      borderRadius: theme['border-radius-sm'],
      height: 44,
    },
  });
  return styles;
};
```

åŸºäº `useStyle` æˆ‘ä»¬ä¾¿å¯å®Œæˆä¸€ä¸ªæ”¯æŒå¤šç±»å‹çš„ Button ç»„ä»¶ï¼š

```tsx
const Button: FunctionComponent<ButtonProps> = props => {
  const styles = useStyle(props);
  const { style, ...restProps } = props;
  return (
    <TouchableHighlight style={[styles.wrapper, style]} {...restProps}>
      <View style={styles.container}>
        {typeof props.children === 'string' ? (
          <Text style={styles.textStyle}>{props.children}</Text>
        ) : (
          props.children
        )}
      </View>
    </TouchableHighlight>
  );
};
```

> æ³¨æ„ï¼šå­ç»„ä»¶å¯èƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯èƒ½æ˜¯ç»„ä»¶ï¼Œæ‰€ä»¥éœ€è¦åˆ¤æ–­ç±»å‹ã€‚

å®ç°æ•ˆæœå¦‚ä¸‹ï¼š

![ç´«ç«¹](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4a0b412c227e4dc994b818294165240d~tplv-k3u1fbpfcp-watermark.image)

### æœ´ç´ æŒ‰é’®

æœ´ç´ æŒ‰é’®çš„æ–‡å­—ä¸ºæŒ‰é’®é¢œè‰²ï¼ŒèƒŒæ™¯ä¸ºç™½è‰²ï¼Œæˆ‘ä»¬é€šè¿‡ `plain` å±æ€§å°†æŒ‰é’®è®¾ç½®ä¸ºæœ´ç´ æŒ‰é’®ã€‚è°ƒç ”äº† antd å’Œ react-native-elements å‘ç°å®ƒä»¬éƒ½æ˜¯å®šä¹‰äº†å¾ˆå¤šæ ·å¼ï¼Œç„¶ååœ¨ç»„ä»¶å†…é€šè¿‡é€»è¾‘åˆ¤æ–­è®¡ç®—å…·ä½“æ ·å¼çš„å€¼ã€‚ä¸ªäººå¾ˆä¸å–œæ¬¢è¿™ç§æ–¹å¼ï¼Œä¸æ˜¯å½»åº•çš„ CSS in JSï¼Œæˆ‘çš„å¤„ç†æ–¹å¼æ˜¯å°†æ‰€æœ‰æœ‰å…³æ ·å¼è®¡ç®—çš„éƒ½å°è£…åœ¨æ¯ä¸ªç»„ä»¶çš„ `useStyle` é’©å­ä¸­ï¼Œæ¯”å¦‚å½“å¼•å…¥æœ´ç´ æŒ‰é’®å±æ€§æ—¶ï¼Œç›¸å¯¹äºæ™®é€šæŒ‰é’®æ”¹å˜çš„æœ‰å®¹å™¨èƒŒæ™¯è‰²ã€å®¹å™¨è¾¹æ¡†å’Œå­—ä½“é¢œè‰²ã€‚æ‰€ä»¥æˆ‘ä»¬å°†è¿™ä¸‰ä¸ªå±æ€§çš„å€¼éƒ½é€šè¿‡ä¸€ä¸ªå•ç‹¬çš„å‡½æ•°è®¡ç®—ã€‚å¯¹æ¯” antd çš„æºç ï¼Œä¼šå‘ç°ä¸ä»…ä»£ç æ›´æ˜“è¯»ï¼Œç”šè‡³ä»£ç é‡ä¹Ÿå°‘äº†ã€‚

```ts
const getBackgroundColor = () => {
  if (props.plain) {
    return theme.white;
  }
  // ...
};

const getTextColor = () => {
  if (props.plain) {
    switch (props.type) {
      case 'primary':
        return theme['success-color'];
      case 'info':
        return theme['primary-color'];
      case 'warning':
        return theme['warning-color'];
      case 'danger':
        return theme['danger-color'];
      default:
        return theme['gray-3'];
    }
  } else if (props.type === 'default') {
    return theme.black;
  } else {
    return theme.white;
  }
};
```

å®ç°æ•ˆæœå¦‚ä¸‹ï¼š

![ç´«ç«¹](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0fc1bedf56fe4dd0a31e6d18b048665c~tplv-k3u1fbpfcp-watermark.image)

### ç»†è¾¹æ¡†

vant å®ç°ç»†è¾¹æ¡†æ˜¯é€šè¿‡è®¾ç½® `hairline` å±æ€§å¯ä»¥å±•ç¤º 0.5px çš„ç»†è¾¹æ¡†ã€‚ä½†æ˜¯æ‰‹æœºä¸Šç”±äºåˆ†è¾¨ç‡çš„å½±å“ï¼Œè´¸ç„¶è®¾ç½® 0.5 ä¼šå¯¼è‡´è¾¹æ¡†ä¸æ˜¾ç¤ºçš„å…¼å®¹é—®é¢˜ã€‚å¥½åœ¨ React Native ä¸ºæˆ‘ä»¬æä¾›äº† `StyleSheet.hairlineWidth` å¸¸é‡æ¥å…¼å®¹æœ€ç»†è¾¹æ¡†é—®é¢˜ï¼Œä¸‹é¢æ˜¯å®˜æ–¹å¯¹å®ƒçš„å®šä¹‰ï¼š

> hairlineWidth è¿™ä¸€å¸¸é‡å§‹ç»ˆæ˜¯ä¸€ä¸ªæ•´æ•°çš„åƒç´ å€¼ï¼ˆçº¿çœ‹èµ·æ¥ä¼šåƒå¤´å‘ä¸ä¸€æ ·ç»†ï¼‰ï¼Œå¹¶ä¼šå°½é‡ç¬¦åˆå½“å‰å¹³å°æœ€ç»†çš„çº¿çš„æ ‡å‡†ã€‚å¯ä»¥ç”¨ä½œè¾¹æ¡†æˆ–æ˜¯ä¸¤ä¸ªå…ƒç´ é—´çš„åˆ†éš”çº¿ã€‚ç„¶è€Œï¼Œä½ ä¸èƒ½æŠŠå®ƒâ€œè§†ä¸ºä¸€ä¸ªå¸¸é‡â€ï¼Œå› ä¸ºä¸åŒçš„å¹³å°å’Œä¸åŒçš„å±å¹•åƒç´ å¯†åº¦ä¼šå¯¼è‡´ä¸åŒçš„ç»“æœã€‚
>
> å¦‚æœæ¨¡æ‹Ÿå™¨ç¼©æ”¾è¿‡ï¼Œå¯èƒ½ä¼šçœ‹ä¸åˆ°è¿™ä¹ˆç»†çš„çº¿ã€‚

ç”±äº `hairline` åªå½±å“äº†å®¹å™¨ `borderWidth` å±æ€§ï¼Œæˆ‘ä»¬ä¸éœ€è¦ç¼–å†™å•ç‹¬çš„æ ·å¼è®¡ç®—å‡½æ•°ï¼š

```ts
const styles = StyleSheet.create({
  // ...
  container: {
    // ...
    borderWidth: props.hairline ? theme['border-width-hairline'] : theme['border-width-base'],
  },
});
```

å®ç°æ•ˆæœå¦‚ä¸‹ï¼š

![ç´«ç«¹](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/43d80d537b07487d9043d718e6541f7e~tplv-k3u1fbpfcp-watermark.image)

### ç¦ç”¨çŠ¶æ€

è¡¨å•å…ƒç´ æˆ–è€…è¯´å¯è§¦æ‘¸å¯ç‚¹å‡»çš„å…ƒç´ ä¸€èˆ¬éƒ½æœ‰ç¦ç”¨çŠ¶æ€ï¼Œvant ä¸­æ˜¯é€šè¿‡ disabled å±æ€§æ¥ç¦ç”¨æŒ‰é’®ï¼Œç¦ç”¨çŠ¶æ€ä¸‹æŒ‰é’®ä¸å¯ç‚¹å‡»ã€‚TouchableHighlight ç»§æ‰¿åœ°æœ‰ `disabled` å±æ€§ï¼Œæˆ‘ä»¬åªéœ€è¦è®¾ç½®ä¸€äº›ç¦ç”¨çŠ¶æ€ä¸‹çš„æŒ‰é’®æ ·å¼å°±å¯ä»¥ï¼ŒæŸ¥çœ‹ vant æºç æˆ‘ä»¬å‘ç°åªéœ€è¦ä¿®æ”¹é€æ˜åº¦ä¸º 0.5 å³å¯ï¼š

```ts
const styles = StyleSheet.create({
  container: {
    // ...
    opacity: props.disabled ? 0.5 : 1,
    // ...
  },
});
```

å®ç°æ•ˆæœå¦‚ä¸‹ï¼š

![ç´«ç«¹](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/892589086d07426a8346319d8466bccf~tplv-k3u1fbpfcp-watermark.image)

### åŠ è½½çŠ¶æ€

vant æ˜¯é€šè¿‡ `loading` å±æ€§è®¾ç½®æŒ‰é’®ä¸ºåŠ è½½çŠ¶æ€ï¼ŒåŠ è½½çŠ¶æ€ä¸‹é»˜è®¤ä¼šéšè—æŒ‰é’®æ–‡å­—ï¼Œå¯ä»¥é€šè¿‡ `loading-text` è®¾ç½®åŠ è½½çŠ¶æ€ä¸‹çš„æ–‡å­—ã€‚æˆ‘ä»¬å€ŸåŠ© React Native çš„ ActivityIndicator ç»„ä»¶å¯ä»¥è½»æ¾å®ç°è¿™ä¸ªç‰¹æ€§ï¼š

```tsx
// ...
<TouchableHighlight {...restProps}>
  <View style={styles.contentWrapper}>
    {props.loading ? (
      <>
        <ActivityIndicator size="small" color={indicatorColor} style={styles.indicator} />
        {props.loadingText ? <Text style={styles.textStyle}>{props.loadingText}</Text> : null}
      </>
    ) : null}
  </View>
</TouchableHighlight>
// ...
```

æ ·å¼å¦‚ä¸‹ï¼š

```ts
export const useIndicatorColor = (props: ButtonProps): string => {
  const theme = useTheme<Theme>();
  if (props.plain) {
    switch (props.type) {
      case 'primary':
        return theme['success-color'];
      case 'info':
        return theme['primary-color'];
      case 'warning':
        return theme['warning-color'];
      case 'danger':
        return theme['danger-color'];
      default:
        return theme.black;
    }
  } else if (props.type === 'default') {
    return theme.black;
  } else {
    return theme.white;
  }
};
```

å®ç°æ•ˆæœå¦‚ä¸‹ï¼š

![ç´«ç«¹](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/27c4340df2254245a3c830bf667a2e28~tplv-k3u1fbpfcp-watermark.image)

### æŒ‰é’®å½¢çŠ¶

é»˜è®¤çš„æŒ‰é’®æœ‰å€¼ä¸º 2 çš„åœ†è§’ï¼Œvant ä¸­é€šè¿‡ `square` è®¾ç½®æ–¹å½¢æŒ‰é’®ï¼Œé€šè¿‡ `round` è®¾ç½®åœ†å½¢æŒ‰é’®ã€‚æŒ‰ä¾‹ï¼Œæˆ‘ä»¬é€šè¿‡åˆ¤æ–­è®¾ç½®æ ·å¼ï¼š

```ts
const getBorderRadius = () => {
  if (props.round) {
    return theme['border-radius-max'];
  }
  if (props.square) {
    return 0;
  }
  return theme['border-radius-sm'];
};
const styles = StyleSheet.create({
  container: {
    borderColor: getBorderColor(),
  },
  wrapper: {
    borderRadius: getBorderRadius(),
  },
});
```

å®ç°æ•ˆæœå¦‚ä¸‹ï¼š

![ç´«ç«¹](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d1402517566e49d1a1920fd9b3f7bb20~tplv-k3u1fbpfcp-watermark.image)

### æŒ‰é’®å°ºå¯¸

Antd RN åªæä¾›äº† largeã€small ä¸¤ä¸ªå°ºå¯¸ï¼Œè€Œåœ¨ vant ä¸­æ”¯æŒ largeã€normalã€smallã€mini å››ç§å°ºå¯¸ï¼Œé»˜è®¤ä¸º normalã€‚è™½ç„¶å†™åˆ°è¿™é‡Œå·²ç»å¾ˆç–²å€¦äº†ï¼Œæ¨æç”˜éœ²ä¹Ÿæ—©å–å®Œäº†ï¼Œä½†æ˜¯ä¸ºäº†å®Œæ•´å¤åŸï¼Œè¿˜æ˜¯ç»­ä¸Šä¸€æ¯å’–å•¡ç»§ç»­è‚ã€‚æ ¹æ® vant è®¾è®¡ç¨¿æˆ‘ä»¬æ–°å¢ä¸‰ä¸ªæ ·å¼è·å–å‡½æ•°å¹¶åŠ¨æ€åŒ–æŒ‡å®šæ ·å¼ï¼š

```ts
const getSizeHeight = () => {
  switch (props.size) {
    case 'large':
      return 50;
    case 'small':
      return 32;
    case 'mini':
      return 24;
    default:
      return 44;
  }
};
const getSizePadding = () => {
  switch (props.size) {
    case 'small':
      return 8;
    case 'mini':
      return 4;
    default:
      return 15;
  }
};
const getSizeFontSize = () => {
  switch (props.size) {
    case 'large':
      return 16;
    case 'small':
      return 12;
    case 'mini':
      return 10;
    default:
      return 14;
  }
};

const styles = StyleSheet.create({
  container: {
    paddingHorizontal: getSizePadding(),
  },
  textStyle: {
    fontSize: getSizeFontSize(),
  },
  wrapper: {
    height: getSizeHeight(),
  },
});
```

å®ç°æ•ˆæœå¦‚ä¸‹ï¼š

![ç´«ç«¹](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/59c01002f25b477d85ed26fa1e21c86b~tplv-k3u1fbpfcp-watermark.image)

### è‡ªå®šä¹‰é¢œè‰²

å¦‚æœä¸æ˜¯è‡ªå·±äº²è‡ªå¤åˆ» Vantï¼Œæ˜¯æ²¡æƒ³åˆ°ä¸€ä¸ª Button èƒ½ç©å‡ºè¿™ä¹ˆå¤šèŠ±ï¼Œæ”¯æŒç‰¹æ€§è¿™ä¹ˆå¤šè€å¿ƒå’Œä»£ç ç®¡ç†éƒ½æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚å½“ç„¶äº†ï¼Œç´«ç«¹é‡‡å–çš„æ ·å¼ç®¡ç†æ–¹å¼æ¯”è¾ƒåæ¿€ï¼Œå¤§å®¶æœ‰å¥½çš„æ–¹å¼ä¹Ÿå¯ä»¥åœ¨è¯„è®ºåŒºè®¨è®ºã€‚

é€šè¿‡ `color` å±æ€§è‡ªå®šä¹‰æŒ‰é’®çš„é¢œè‰²ã€‚æˆ‘ä»¬å¯ä»¥å¾—å‡ºéœ€æ±‚ï¼Œä¸ç®¡ type æ˜¯ä»€ä¹ˆï¼Œ`color` å±æ€§éœ€å§‹ç»ˆè¦†ç›–åŸæœ‰æ ·å¼ï¼Œcolor èƒ½å½±å“çš„å°±æ˜¯èƒŒæ™¯è‰²ã€å­—ä½“é¢œè‰²å’Œè¾¹æ¡†é¢œè‰²ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¿®æ”¹ `getBackgroundColor`ã€`getTextColor`ã€`getBorderColor` æ ·å¼å‡½æ•°åœ¨åˆé€‚çš„åœ°æ–¹åŠ ä¸Šä»¥ä¸‹ä»£ç å³å¯ï¼š

```ts
if (props.color) {
  return props.color;
}
```

å®ç°æ•ˆæœå¦‚ä¸‹ï¼š

![ç´«ç«¹](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8efffdbfd6424618be6152895a53e8ee~tplv-k3u1fbpfcp-watermark.image)

## åŒå‡»äº‹ä»¶çš„å®ç°

æˆ‘ä»¬ä» React Native å†…ç½®çš„ TouchableHighlight ç»„ä»¶ç»§æ‰¿äº†å¾ˆå¤šäº‹ä»¶ï¼Œå…¶ä¸­ onPressã€onLongPress åˆ†åˆ«ä»£è¡¨å•å‡»å’Œé•¿æŒ‰ã€‚ä½†å”¯ç‹¬â€œåŒå‡» 666â€çš„åŒå‡»äº‹ä»¶æ²¡æœ‰å§“åã€‚ä¹‹å‰åœ¨å®é™…ä¸šåŠ¡æ›¾ç»å°è£…è¿‡åŒå‡»äº‹ä»¶ï¼Œè¿™æ¬¡æˆ‘ä»¬å°±ç›´æ¥å°±å†…ç½®äº†ã€‚

å®ç°æ€è·¯æ˜¯å»¶æ—¶æ‰§è¡Œå•å‡»äº‹ä»¶ï¼ˆé»˜è®¤ 200 æ¯«ç§’ï¼‰ï¼Œç„¶åè®°å½•ç‚¹å‡»æ¬¡æ•°å’Œä¸¤æ¬¡æ—¶é—´é—´éš”ï¼Œå½“è¯†åˆ«ä¸ºç¬¬äºŒæ¬¡ç‚¹å‡»ä¸”æ—¶é—´é—´éš”å°äºå•å‡»å»¶æ—¶æ—¶é—´ã€‚é‚£ä¹ˆå°±å–æ¶ˆå•å‡»äº‹ä»¶å»¶æ—¶ï¼Œå¹¶ç«‹å³æ‰§è¡ŒåŒå‡»äº‹ä»¶ã€‚å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š

```tsx
let lastTime = 0;
let clickCount = 1;
let timeout = null;
const _onPress = (event: GestureResponderEvent) => {
  const now = Date.now();
  if (timeout) {
    clearTimeout(timeout);
  }
  timeout = setTimeout(() => {
    props.onPress(event);
    clickCount = 1;
    lastTime = 0;
  }, props.delayDoublePress);
  if (clickCount === 2 && now - lastTime <= props.delayDoublePress) {
    clearTimeout(timeout);
    clickCount = 1;
    lastTime = 0;
    props.onDoublePress(event);
  } else {
    clickCount++;
    lastTime = now;
  }
};
```

å¤§å®¶ä¼šå‘ç°è¿™é‡Œçš„å®ç°ç³…åˆäº†å‡½æ•°é˜²æŠ–ã€èŠ‚æµä»¥åŠè®¡æ•°å™¨çš„åŸç†ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªè¡Œå¤ä¹ ä¸‹åŸç†ï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†ã€‚

## API æ–‡æ¡£

ä¸€ä¸ªç»„ä»¶çš„æ–‡æ¡£ï¼Œé™¤äº† Demoï¼Œè¿˜éœ€è¦å±•ç¤ºå‡ºæ¥å¯ç”¨çš„ Propsï¼ŒDumi å†…ç½®çš„ `<API></API>` ç»„ä»¶å¯ä»¥æ ¹æ®ç»„ä»¶è‡ªåŠ¨ç”Ÿæˆ API æ–‡æ¡£ã€‚é¦–å…ˆæˆ‘ä»¬åƒä¸‹é¢ä¸€æ ·ç¼–å†™ Props æ³¨é‡Šï¼š

```ts
interface ButtonProps extends TouchableHighlightProps {
  /**
   * @description       Can be set to primaryã€infoã€warningã€danger
   * @description.zh-CN ç±»å‹ï¼Œå¯é€‰å€¼ä¸º primaryã€infoã€warningã€danger
   */
  type?: 'default' | 'primary' | 'info' | 'warning' | 'danger';
  /**
   * @description       Can be set to largeã€smallã€mini
   * @description.zh-CN å°ºå¯¸ï¼Œå¯é€‰å€¼ä¸º
   */
  size?: 'large' | 'normal' | 'small' | 'mini';
}
```

ç„¶ååœ¨ Markdown ä¸­å¼•å…¥ API ç»„ä»¶å³å¯ï¼š

```md
<API src="./index.tsx"></API>
```

å†…ç½®ç»„ä»¶ API æ²¡æœ‰å¤„ç†ç»§æ‰¿çš„æƒ…å†µï¼Œæˆ‘ä»¬åç»­ä¼šè‡ªå®šä¹‰ä¸€ä¸ª API ç»„ä»¶ï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†ï¼Œæµè§ˆ [Button æ–‡æ¡£](https://vant-react-native.js.org/components/button#api) å¯ä»¥æŸ¥çœ‹ç°åœ¨çš„æ•ˆæœï¼š

![ç´«ç«¹](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7bedac7240334ff79c4142005a66b158~tplv-k3u1fbpfcp-watermark.image)

## å·¥ç¨‹åŒ–ä¸²è®²

ç”±äºå¾ˆéš¾åœ¨ä¸€ç¯‡æ–‡ç« ä¸­å°†ç»„ä»¶å¼€å‘ç›¸å…³çš„å·¥ç¨‹åŒ–è®²å®Œï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ¯ç¯‡å®æˆ˜ä¸­ä¸²è®²ä¸€ä¸‹ã€‚

### ç»„ä»¶åˆ›å»ºè„šæ‰‹æ¶

> å°é»‘ï¼šç´«ç«¹ï¼Œ`lerna create` å‘½ä»¤åˆ›å»ºå‡ºæ¥çš„æ¨¡å—å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œä»¥åè¦åˆ›å»ºå¾ˆå¤šå¾ˆå¤šç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªåˆ›å»ºç»„ä»¶æ¨¡å—çš„è„šæ‰‹æ¶å—ï¼Ÿ

lerna ä½¿ç”¨èµ·æ¥æ˜¯æœ‰ä¸å°‘ç—›ç‚¹çš„ï¼Œ`lerna create` å‘½ä»¤æ²¡åŠæ³•æŒ‡å®šæ¨¡æ¿ï¼Œè€ƒè™‘åˆ°ä¹‹åçš„å‡ åä¸Šç™¾ä¸ªç»„ä»¶æ¯æ¬¡åˆ›å»ºéƒ½è¦è¿›è¡Œé¡¹ç›®ç»“æ„ã€Typescript é…ç½®ã€å•å…ƒæµ‹è¯•é…ç½®ã€Babel é…ç½®ç­‰ç­‰å·¥ä½œæ­¥éª¤ï¼Œæˆ‘ä»¬æœ‰å¿…è¦å†™ä¸€ä¸ªè„šæ‰‹æ¶ã€‚

#### æ¨¡æ¿è§£æ

è¯´åˆ°æ¨¡æ¿è§£æï¼Œç›¸ä¿¡å¤§å®¶å’Œæˆ‘ä¸€æ ·æƒ³åˆ°çš„æ˜¯ vue-cli çš„ template è§£æã€‚é€šè¿‡é˜…è¯» [vue-cli@2.9.6 generate.js](https://cdn.jsdelivr.net/npm/vue-cli@2.9.6/lib/generate.js) æºç ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æå‡ºå°¤å¤§æ˜¯åŸºäº metalsmithã€handlebarsã€consolidate è¿™ä¸‰ä¸ªåŒ…æ¥å®ç°æ¨¡æ¿è§£æèƒ½åŠ›çš„ã€‚è®©äººä¸å®‰çš„æ˜¯å…¶ä¸­ metalsmith åº“æœ‰é•¿è¾¾ 5 å¹´æ²¡æœ‰ç»´æŠ¤äº†ï¼Œç´«ç«¹æŒ‘é€‰å¼€æºé¡¹ç›®ä¸€èˆ¬å¯¹ç»´æŠ¤åº¦å¾ˆæ•æ„Ÿï¼Œæœ¬ç€è½®å­è¦ç”¨è‡ªå·±é€ çš„åŸåˆ™ï¼Œæˆ‘ç¿»çœ‹äº† Metalsmith çš„ Readme å‘ç°è¿™ä¸ªæ’ä»¶æ— éæ˜¯é€šè¿‡é€’å½’è¯»æ–‡ä»¶çš„æ–¹å¼æ¸²æŸ“æ¨¡æ¿ï¼Œå¹¶ä¸”å®ƒçš„é™æ€ç½‘ç«™ç”Ÿæˆçš„èƒ½åŠ›å¯¹æˆ‘ä»¬æ¨¡æ¿è§£æçš„éœ€æ±‚ä¹Ÿæ˜¯å¤šä½™çš„ã€‚

è¯´å¹²å°±å¹²ï¼Œåœ¨å’Œ [@æ—å°å¸…](https://juejin.cn/user/3175045313873943) åŒå­¦ç®€å•æ²Ÿé€šåï¼Œæˆ‘åŠ¨æ‰‹é€ äº† [handlebars-template-compiler](https://github.com/youngjuning/handlebars-template-compiler) è¿™ä¸ªè½®å­ï¼Œå…¶ä¸»è¦åŸç†å¦‚ä¸‹ï¼š

1. ä½¿ç”¨ recursive-readdir é€’å½’è·å–æ‰€æœ‰æ–‡ä»¶è·¯å¾„

```js
const files = await recursive(rootDir);
```

2. ä½¿ç”¨ `handlebars.compile` æ–¹æ³•ä½¿ç”¨å…ƒæ•°æ®å¯¹æ¨¡æ¿è¿›è¡Œæ¸²æŸ“

```js
const content = fs.readFileSync(file).toString();
const result = handlebars.compile(content)(meta);
```

3. ä½¿ç”¨ `fs.writeFileSync` API é‡å†™æ–‡ä»¶

å¦å¤–ï¼Œé€šè¿‡å¼•å…¥ [glob](https://www.npmjs.com/package/micromatch) æ¨¡å¼åŒ¹é…å®ç°äº† `exclude` é…ç½®ä»¥åŠåªå¤„ç†æŒ‡å®šåç¼€ï¼ˆé»˜è®¤ `**/*.tpl.*`ï¼‰çš„æ–‡ä»¶æ¥é¿å…ä¸å¿…è¦çš„æ¸²æŸ“ã€‚ï¼ˆPSï¼šNPM ä¸€å‘¨æœ‰äº† 300 å¤šä¸‹è½½ï¼Œæœ‰éœ€è¦çš„æ˜å‹å€¼å¾—ä¸€è¯•ğŸ˜„ï¼‰

#### Node CLIï¼ˆ@vant-react-native/scriptsï¼‰æ­å»º

è¿™é‡Œç´«ç«¹å°è¯•ç”¨æœ€ç®€æ´çš„è¯­è¨€ä¸ºå¤§å®¶æè¿°ä¸€ä¸ªè„šæ‰‹æ¶çš„è¯ç”Ÿï¼Œæºç åœ¨ [packages/scripts](https://github.com/youngjuning/vant-react-native/tree/main/packages/scripts) ç›®å½•ä¸‹ï¼Œæ²¡æœ‰æ¥è§¦è¿‡ CLI çš„æ˜å‹è¯·ç›¸ä¿¡æˆ‘ï¼ŒNode CLI å¾ˆå®¹æ˜“ä¸Šæ‰‹çš„ã€‚æ¥è§¦è¿‡çš„åŒå­¦ä¹Ÿå¯ä»¥æŸ¥æ¼è¡¥ç¼ºå€Ÿé‰´ä¸€äºŒã€‚

1. `package.json` æ–‡ä»¶çš„ `bin` å­—æ®µæ˜¯æˆ‘ä»¬è„šæ‰‹æ¶çš„å…¥å£

```json
// æŒ‡å®šå¯æ‰§è¡Œæ–‡ä»¶çš„ä½ç½®ä»¥åŠåˆ«å
"bin": {
  "vant": "./bin/cli.js"
},
```

2. å®šä¹‰ `./bin/cli.js` ä¸ºå¯æ‰§è¡Œæ–‡ä»¶å¹¶è°ƒç”¨ `init` æ–¹æ³•ã€‚

```js
// ç”±äºæˆ‘ä»¬çš„è„šæœ¬æ˜¯ Node ç¼–å†™çš„ï¼Œæ‰€ä»¥éœ€è¦æŒ‡å®š node æ‰€åœ¨ä½ç½®
#!/usr/bin/env node
const { init } = require('../lib');
// è¿™ä¸ªåœ°æ–¹å‚è€ƒäº† create-react-native çš„è®¾è®¡
// æœ¬æ–‡ç‚¹èµè¿‡ 300ï¼Œä¸‹ä¸€ç¯‡ç´«ç«¹å¸¦å°é»‘ä¸ºå¤§å®¶å¸¦æ¥ã€ŠåŸºäº TypeScript é‡æ„ create-react-nativeã€‹
init();
```

3. ç„¶ååœ¨ `src/index.ts` ä¸­åˆå§‹åŒ– commander è¿™ä¸ªä¹…è´Ÿç››åçš„å‘½ä»¤è¡Œæ¡†æ¶

```ts
const init = (): void => {
  const packageJson = require('../package.json');
  program.version(packageJson.version).description(packageJson.description);
  // ...
  program.parse(process.argv);
};
```

4. ä¸ºäº†æ–¹ä¾¿ç®¡ç†å‘½ä»¤ï¼Œæˆ‘ä»¬å°†å‘½ä»¤éƒ½æ”¾ç½®åœ¨ `src/commands` ç›®å½•ä¸‹å¹¶é€šè¿‡ `fs.readdirSync` API åŠ¨æ€æ‰«ææ³¨å†Œã€‚

```ts
const init = (): void => {
  // è¿™æ®µä»£ç å€Ÿé‰´è‡ª NeteaseCloudMusicApi é¡¹ç›®ï¼Œä½œè€…çš„ä»£ç å¾ˆæœ‰è®¾è®¡æ„Ÿï¼Œæ¨èé˜…è¯»ã€‚
  fs.readdirSync(path.join(__dirname, 'commands')).forEach((file: string) => {
    if (!file.endsWith('.js')) return;
    require(path.join(__dirname, 'commands', file));
  });
  // ...
};
```

5. æœ€ååœ¨ `commands` ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª `create.ts` æ–‡ä»¶ç¼–å†™å‘½ä»¤

```ts
import { program } from 'commander';
program
  .command('create <name> [loc]')
  .description('Create a new vant-react-native package')
  .action((name,loc) => {
    console.log('Hello Luozhu');
  })
```

#### è„šæ‰‹æ¶å®ç°

ä¸Šä¸€å°ç»“ï¼Œæˆ‘ä»¬åˆå§‹åŒ–äº† CLI å¹¶æ·»åŠ äº† `create` å‘½ä»¤ï¼Œè¿™ä¸€å°èŠ‚æˆ‘ä»¬å°±æ¥å®ç°ä¸€ä¸‹è„šæ‰‹æ¶åŠŸèƒ½ã€‚

æˆ‘ä»¬é¦–å…ˆåœ¨ `packages/scripts` ç›®å½•ä¸‹åˆ›å»ºç»„ä»¶æ¨¡æ¿

```sh
.
â”œâ”€â”€ README.tpl.md # tpl åç¼€åœ¨ç”Ÿæˆç»„ä»¶æ¨¡æ¿çš„æ—¶å€™ä¼šè¢« handlebars-template-compiler è‡ªåŠ¨å»æ‰ã€‚
â”œâ”€â”€ package.tpl.json
â”œâ”€â”€ src
â”‚   â””â”€â”€ index.ts # æ²¡æœ‰ tpl åç¼€åˆ™ä¸ä¼šè¢«ç¼–è¯‘ï¼Œæ¨¡æ¿å¾ˆå¤§æ—¶å¯ä»¥èŠ‚çœæ—¶é—´ã€‚
â””â”€â”€ tsconfig.json
```

ç„¶åæˆ‘ä»¬æ˜ç¡®æˆ‘ä»¬çš„æ¨¡æ¿å…ƒæ•°æ®çš„æ•°æ®ç»“æ„ï¼Œæˆ‘è¿™é‡Œçš„æ•°æ®ç»“æ„æ˜¯ï¼š

```ts
interface IMeta {
  name: string;
  version: string;
  description: string;
  author: string;
  email: string;
  url: string;
  directory: string;
}
```

æœ‰äº†æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ inquirer æ¨¡å—å¼•å¯¼ç”¨æˆ·è¾“å…¥ä¿¡æ¯ã€‚

```ts
import inquirer from 'inquirer';
// ...
// getQuestions è¿‡é•¿ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥æŸ¥çœ‹ï¼šhttp://tny.im/UFbg
const answer: IMeta = await inquirer.prompt(getQuestions(name));
// ...
```

ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ `tmp-promise` æ¨¡å—åˆ›å»ºä¸€ä¸ªç³»ç»Ÿä¸´æ—¶æ–‡ä»¶å¤¹ï¼Œå¹¶å°†å‰æ–‡æåˆ°çš„ template æ–‡ä»¶å¤¹çš„å†…å®¹æ‹·è´è¿›å»ï¼š

```ts
import tmp from 'tmp-promise';
import fs from 'fs-extra';
import path from 'path';
// ...
const tmpdir = await tmp.dir({ unsafeCleanup: true });
fs.copySync(path.join(__dirname, '../../template'), tmpdir.path);
```

æœ€åï¼Œæˆ‘ä»¬å¯¹ä¸´æ—¶æ–‡ä»¶å¤¹çš„å†…å®¹è¿›è¡Œç¼–è¯‘å†æ‹·è´åˆ°æŒ‡å®šä½ç½®å³å¯ï¼š

```ts
import htc from 'handlebars-template-compiler';
// ...
await htc<IMeta>(answer, tmpdir.path);
fs.copySync(tmpdir.path, `${process.cwd()}/packages/${locPath}`);
// ...
```

æŠ˜è…¾è¿™ä¸€é¡¿ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸‹æˆæœå§ï¼š

![ç´«ç«¹](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4ba477bcbd8b4ef6b880c7e8e5a095bc~tplv-k3u1fbpfcp-zoom-1.image)

### Github CODEOWENERS

å¤§å‹çš„å¼€æºé¡¹ç›®æœ€éš¾çš„ä¸æ˜¯æŠ€æœ¯é—®é¢˜ï¼ŒæŠ€æœ¯å¤§å’–æ°¸è¿œä¸ä¼šç¼ºã€‚æœ€éš¾çš„å…¶å®æ˜¯åä½œå’ŒåæœŸç»´æŠ¤ã€‚è¯•æƒ³ä¸€ä¸‹ä¸€ä¸ªæˆç™¾ä¸Šåƒäººå‚ä¸çš„é¡¹ç›®å½“æœ‰æ–°çš„ pr æ—¶ï¼Œæ­£å¸¸äººæ ¹æœ¬æ— åŠ›å»å¿«é€Ÿæ£€ç´¢å‡ºéœ€è¦è°å» review ä»£ç ã€‚æˆ‘ä»¬çš„ vant-react-native ç”±äºæ˜¯å°†æ¯ä¸ªç»„ä»¶å•ç‹¬å‘åŒ…ç»´æŠ¤ï¼Œå½“å‚ä¸çš„å°ä¼™ä¼´å¤šäº†ä¹Ÿä¼šäº§ç”Ÿè¿™ä¸ªå›°æ‰°ã€‚

è€Œ GitHub CODEOWNERSï¼ˆä»£ç æ‰€æœ‰è€…ï¼‰å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼Œåœ¨ 5000+ è´¡çŒ®è€…å‚ä¸çš„ [DefinitelyTyped](https://github.com/DefinitelyTyped/DefinitelyTyped) é¡¹ç›®ä¸­æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°å®ƒçš„èº«å½±ã€‚å®˜æ–¹å¯¹ä»£ç æ‰€æœ‰è€…å®šä¹‰å¦‚ä¸‹ï¼š

> ä½ å¯ä»¥ä½¿ç”¨ CODEOWNERS æ–‡ä»¶å®šä¹‰è´Ÿè´£ä»“åº“ä»£ç çš„ä¸ªäººæˆ–å›¢é˜Ÿã€‚å½“æœ‰äººä¿®æ”¹ä»£ç å¹¶æ‰“å¼€ä¸€ä¸ª pull request æ—¶ï¼Œå°†è‡ªåŠ¨è¯·æ±‚ä»£ç æ‰€æœ‰è€…è¿›è¡Œå®¡æŸ¥ã€‚

CODEOWNERS æ–‡ä»¶ä½¿ç”¨éµå¾ª gitignore æ–‡ä»¶ä¸­æ‰€ç”¨å¤§å¤šæ•°è§„åˆ™çš„æ¨¡å¼ï¼ŒCODEOWNERS æ–‡ä»¶ä½ç½®ä¸€èˆ¬ä½äº `.github/` ç›®å½•ä¸‹ã€‚

åœ¨ vant-react-nativeï¼Œç´«ç«¹æ˜¯ä»“åº“çš„æœ€ç»ˆè´Ÿè´£äººï¼Œæ‰€ä»¥æ˜¯æœŸæœ›æ¯ä¸ª pr éƒ½å¯ä»¥åˆ†é…ç»™è‡ªå·±å®¡æŸ¥ä¸€ä¸‹çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬è¿™å°±æ¥å®éªŒä¸€ä¸‹å§ï¼Œæ–°å»ºä¸€ä¸ª `.github/CODEOWNERS` æ–‡ä»¶å¹¶å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š

```
# This is a comment.
# Each line is a file pattern followed by one or more owners.

# These owners will be the default owners for everything in
# the repo. Unless a later match takes precedence,
# @youngjuning will be requested for review when someone opens a pull request.
*       @youngjuning

# In this example, @doctocat owns any files in the build/logs
# directory at the root of the repository and any of its
# subdirectories.
/packages/ @luozhu1994
```

ä¸€èˆ¬å¦‚æœæ–‡ä»¶å…·æœ‰ä»£ç æ‰€æœ‰è€…ï¼Œåˆ™åœ¨æ‰“å¼€æ‹‰å–è¯·æ±‚ä¹‹å‰å¯ä»¥çœ‹åˆ°ä»£ç æ‰€æœ‰è€…æ˜¯è°ã€‚åœ¨ä»“åº“ä¸­ï¼Œä½ å¯ä»¥æ‰¾åˆ°æ–‡ä»¶å¹¶æ‚¬åœäºä¸€ä¸ªé”å›¾æ ‡ä¸Šï¼Œæ‚¬æµ®ä¹‹åä¼šå‘Šè¯‰ä½ è¯¥æ–‡ä»¶æ‰€æœ‰è€…æ˜¯è°ï¼š

![ç´«ç«¹](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/726bd5144a104902ae27ad31e1d46f93~tplv-k3u1fbpfcp-zoom-1.image)

ç„¶åæˆ‘ä»¬æäº¤ä¸€ä¸ª pr çœ‹çœ‹æ•ˆæœï¼š

![ç´«ç«¹](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bf4cb8b7ef5c41989660e735e621fc4e~tplv-k3u1fbpfcp-zoom-1.image)

### NPM å‘åŒ…è‡ªåŠ¨åŒ–

å‘åŒ…æƒé™ä¸€èˆ¬åªæœ‰ä»“åº“æ‰€æœ‰è€…ä¸€ä¸ªäººæ‹¥æœ‰ï¼Œä½†æ˜¯ owner åŒæ—¶ç»´æŠ¤å¥½å‡ ä¸ª NPM è´¦å·ï¼Œæˆ–è€…æ˜¯ owner å¿½ç„¶å¾ˆå¿™å°†å‘å¸ƒæƒé™äº¤ç»™å…¶ä»–äººç®¡ç†å‘˜ä½†æ˜¯ä¸ä¾¿å‘ŠçŸ¥ NPM è´¦å·è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿç­”æ¡ˆæ˜¯å°† NPM å‘åŒ… CDï¼ˆæŒç»­éƒ¨ç½²ï¼‰åŒ–ï¼Œå…¬å¸ä¸€èˆ¬ä¼šåŸºäº Gitlab æˆ–è‡ªå»ºå¹³å°å®ç°è¯¥åŠŸèƒ½ã€‚ä½œä¸ºå¼€æºé¡¹ç›®ï¼Œæˆ‘ä»¬å½“ç„¶æ˜¯ä½¿ç”¨ GitHub Actionã€‚

æ­£å¸¸çš„å•åŒ…é¡¹ç›®ï¼Œä½¿ç”¨ [npm-publish](https://github.com/JS-DevTools/npm-publish) æˆ– [npm-publish-action](https://github.com/pascalgn/npm-publish-action) è¿™ä¸¤ä¸ª GitHub Actionï¼Œè¿™å¹¶æ²¡æœ‰å¥½è®²çš„ã€‚ä½†æ˜¯åŸºäº lerna çš„å¤šåŒ…å•ä½“ä»“åº“å¹¶æ²¡æœ‰ç°æˆçš„æ’ä»¶å¯ä»¥ç”¨ï¼Œç…§ä¾‹ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹è‡ªå·±å®ç°çš„æ­¥éª¤ï¼š

1. åˆ¤æ–­ commit message æ˜¯å¦ä»¥ `chore(release):` å¼€å¤´
    > é€šè¿‡ GitHub Action `startsWith(github.event.head_commit.message, 'chore(release):')` å®ç°
2. é€šè¿‡ NPM publish token è®¤è¯ç™»å½•
    > é€šè¿‡ `npm config set //registry.npmjs.org/:_authToken=${{ secrets.NPM_TOKEN }}` è®¤è¯
3. æ‰§è¡Œ `lerna publish from-package --yes` å‘å¸ƒ
    > éœ€è¦æœ¬åœ°å…ˆæ‰§è¡Œ `lerna version` ç³»åˆ—å‘½ä»¤æå‡ç‰ˆæœ¬

å®Œæ•´ GitHub Action å®ç°å¦‚ä¸‹ï¼š

```yml
name: npm-publish

on:
  push:
    branches:
      - main

jobs:
  npm-publish:
    runs-on: ubuntu-latest
    if: startsWith(github.event.head_commit.message, 'chore(release):')
    steps:
      - uses: actions/checkout@v2
      - uses: c-hive/gha-yarn-cache@v2 # ç¼“å­˜ node_modules åŠ å¿«æ„å»ºé€Ÿåº¦
      - name: Install Packages
        run: yarn install --registry=https://registry.npmjs.org/
      - name: Authenticate with Registry
        run: |
          npm config set //registry.npmjs.org/:_authToken=${NPM_TOKEN}
        env:
          NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
      - name: Publish package
        run: lerna publish from-package --yes
```

ä¸ºäº†åœ¨å‘å¸ƒååŠæ—¶è·å–é€šçŸ¥ï¼Œç´«ç«¹ä½¿ç”¨äº† `peter-evans/commit-comment` æ’ä»¶åœ¨å‘å¸ƒå¤±è´¥æˆ–æˆåŠŸåå¯¹ç›¸åº” commit è¿›è¡Œè¯„è®ºï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ”¶åˆ°é‚®ä»¶å’Œç«™å†…é€šçŸ¥ã€‚

```yml
- name: Create commit comment after publish successfully
  if: ${{ success() }}
  uses: peter-evans/commit-comment@v1
  with:
    body: |
      Hello Dear @youngjuning. This commit has been publish to NPM successfully.
      > Created by [commit-comment][1]

      [1]: https://github.com/peter-evans/commit-comment
- name: Create commit comment after publish unsuccessfully
  if: ${{ failure() }}
  uses: peter-evans/commit-comment@v1
  with:
    body: |
      Hello Dear @youngjuning. This commit has been publish to NPM unsuccessfully.
      > Created by [commit-comment][1]

      [1]: https://github.com/peter-evans/commit-comment
```
