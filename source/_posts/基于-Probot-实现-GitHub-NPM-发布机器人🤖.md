---
title: åŸºäº Probot å®ç° GitHub NPM å‘å¸ƒæœºå™¨äººğŸ¤–
date: 2023-03-08 17:21:07
description: GitHub Apps æ˜¯ GitHub ä¸­ä¼˜ç§€çš„äº§å“ã€‚ä¸€ä¸ª GitHub App é€šè¿‡ API ç›´æ¥ä½¿ç”¨è‡ªå·±çš„èº«ä»½è¿›è¡Œæ“ä½œï¼Œè¿™æ„å‘³ç€ä½ ä¸éœ€è¦ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„ç”¨æˆ·ç»´æŠ¤ä¸€ä¸ªæœºå™¨äººæˆ–æœåŠ¡è´¦æˆ·ã€‚
categories:
  - è¿ç»´
tags:
  - GitHub
  - NPM
  - Probot
  - æœºå™¨äºº
---

<ins class="adsbygoogle" style="display:block; text-align:center;"  data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-7962287588031867" data-ad-slot="2542544532"></ins><script> (adsbygoogle = window.adsbygoogle || []).push({});</script>


## å…³äº Github Apps

GitHub Apps æ˜¯ GitHub ä¸­ä¼˜ç§€çš„äº§å“ã€‚ä¸€ä¸ª GitHub App é€šè¿‡ API ç›´æ¥ä½¿ç”¨è‡ªå·±çš„èº«ä»½è¿›è¡Œæ“ä½œï¼Œè¿™æ„å‘³ç€ä½ ä¸éœ€è¦ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„ç”¨æˆ·ç»´æŠ¤ä¸€ä¸ªæœºå™¨äººæˆ–æœåŠ¡è´¦æˆ·ã€‚

GitHub Apps å¯ä»¥è¢«ç›´æ¥å®‰è£…åˆ°ç»„ç»‡æˆ–è€…ç”¨æˆ·è´¦å·ä¸Šï¼Œå¹¶ä¸”å¯ä»¥èµ‹äºˆå®ƒä»¬è®¿é—®æŒ‡å®šä»“åº“çš„æƒé™ã€‚å®ƒä»¬å¸¦æœ‰å†…ç½®çš„ webhook å’Œç‹­çª„çš„ç‰¹å®šæƒé™ã€‚è®¾ç½® GitHub åº”ç”¨ç¨‹åºæ—¶ï¼Œå¯ä»¥é€‰æ‹©å¸Œæœ›å®ƒè®¿é—®çš„ä»“åº“ã€‚æ¯”å¦‚ä½ å¯ä»¥è®¾ç½®ä¸€ä¸ªå« `MyGitHub` çš„åº”ç”¨ç¨‹åºï¼Œè¯¥åº”ç”¨ç¨‹åºæœ‰ä¸”ä»…æœ‰ `octocat` ä»“åº“çš„å†™å…¥ `issues` çš„æƒé™ã€‚å®‰è£… GitHub App éœ€è¦ä½ æ˜¯ç»„ç»‡çš„æ‰€æœ‰è€…æˆ–å¯¹ä»“åº“æ‹¥æœ‰ admin æƒé™ã€‚

## å…³äº Probot

Probot æ˜¯ä¸€ä¸ªåŸºäº Node.js æ„å»º GitHub Apps çš„æ¡†æ¶ã€‚å®ƒæ—¨åœ¨æ¶ˆé™¤æ‰€æœ‰ç¹ççš„äº‹æƒ…ï¼Œå¦‚æ¥æ”¶å’ŒéªŒè¯ webhooks ä»¥åŠåšè®¤è¯åŠ¨ä½œï¼Œè¿™æ ·ä½ å°±å¯ä»¥ä¸“æ³¨äºä½ æƒ³è¦å®ç°çš„åŠŸèƒ½ã€‚Probot åº”ç”¨ç¨‹åºéå¸¸å®¹æ˜“ç¼–å†™ã€éƒ¨ç½²å’Œåˆ†äº«ã€‚å¤§å¤šæ•°æµè¡Œçš„ Probot åº”ç”¨è¢«æ‰˜ç®¡ï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦åšä»»ä½•éƒ¨ç½²å’Œç®¡ç†å·¥ä½œã€‚è¿™é‡Œæœ‰å‡ ä¸ªåŸºäº Probot æ„å»ºçš„åº”ç”¨ï¼š

- [ESLint Disable Watcher][eslint-disable] - å½“ pr ä¸­å°è¯•ç¦ç”¨ eslint è§„åˆ™æ—¶è¿›è¡Œè¯„è®ºã€‚
- [Developer Certificate of Origin][dco] - å¼ºåˆ¶ Pull Requests ç¬¦åˆ DCO è§„èŒƒ
- [Issue Check][issue-check] - æ ¹æ®å…³é”®å­—å’Œä»»åŠ¡åˆ—è¡¨æ£€æŸ¥ issues ä»¥ç¡®ä¿åŒ…å«å¿…è¦çš„ä¿¡æ¯
- [Pull][pull] - Keep your forks up-to-date.

ä½ å¯ä»¥åœ¨[ç‰¹è‰²åº”ç”¨][featured-apps]æˆ–[GitHub probot-app è¯é¢˜][github-probot-app-topics]æµè§ˆæ›´å¤šåº”ç”¨ã€‚

## Hello Probot

ä¸€ä¸ª Probot åº”ç”¨æœ¬è´¨ä¸Šæ˜¯å¯¼å‡ºä¸€ä¸ªå‡½æ•°çš„ [Node.js æ¨¡å—][node-modules]ï¼š

```ts
module.exports = app => {
  // your code here
};
```

`app` å‚æ•°æ˜¯ [Probot][probot-class] ç±»çš„å®ä¾‹ï¼Œè¯¥å®ä¾‹å¯ä»¥è®©ä½ è®¿é—®æ‰€æœ‰çš„ GitHub ç²¾åã€‚

`aap.on` è´Ÿè´£ç›‘å¬æ‰€æœ‰ [GitHub è§¦å‘çš„ webhook äº‹ä»¶][webhooks]ï¼Œå½“ GitHub ä¸Šå‘ç”Ÿä»»ä½•æœ‰è¶£çš„äº‹æƒ…ï¼Œä½ çš„åº”ç”¨ç¨‹åºæƒ³çŸ¥é“çš„æ—¶å€™ï¼Œå®ƒä¼šé€šçŸ¥ä½ ã€‚

```ts
module.exports = app => {
  app.on('issues.opened', async context => {
    // ä¸€ä¸ªæ–°çš„ issue è¢«æ‰“å¼€ï¼Œæˆ‘ä»¬åº”è¯¥åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ
    context.log.info(context.payload);
  });
};
```

ä¼ é€’ç»™äº‹ä»¶å¤„ç†ç¨‹åºçš„ä¸Šä¸‹æ–‡åŒ…æ‹¬å…³äºè¢«è§¦å‘çš„äº‹ä»¶çš„ä¸€åˆ‡ï¼Œä»¥åŠä¸€äº›æœ‰ç”¨çš„å±æ€§ï¼Œä»¥ä¾¿å¯¹äº‹ä»¶åšå‡ºæœ‰ç”¨çš„å›åº”ã€‚`context.octokit` æ˜¯ä¸€ä¸ªç»è¿‡è®¤è¯çš„ GitHub å®¢æˆ·ç«¯ï¼Œå¯ä»¥ç”¨æ¥[è¿›è¡Œ REST API å’Œ GraphQL è°ƒç”¨][github-api]ï¼Œå¹¶å…è®¸ä½ ä»¥ç¼–ç¨‹æ–¹å¼åšå‡ ä¹ä»»ä½•ä½ å¯ä»¥åœ¨ GitHub ä¸Šé€šè¿‡æµè§ˆå™¨åšçš„äº‹æƒ…ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªå½“æ–°æ‰“å¼€ issues æ—¶è‡ªåŠ¨è¯„è®ºçš„ Appã€‚

```ts
module.exports = app => {
  app.on('issues.opened', async context => {
    // context` ä»äº‹ä»¶ä¸­æå–ä¿¡æ¯ï¼Œå¯ä»¥ä¼ é€’ç»™ GitHub API è°ƒç”¨ã€‚è¿™å°†è¿”å›ï¼š
    // { owner: 'yourname', repo: 'yourrepo', number: 123, body: 'Hello World !}
    const params = context.issue({ body: 'Hello World!' });

    // åœ¨ issue ä¸Šå‘ä¸€æ¡è¯„è®º
    return context.octokit.issues.createComment(params);
  });
};
```

## å¼€å‘ä¸€ä¸ª Probot app

ä¸ºäº†å¼€å‘ä¸€ä¸ª Probot appï¼Œä½ é¦–å…ˆéœ€è¦å®‰è£… Node.js 10.0.0 æˆ–æ›´æ–°çš„ç‰ˆæœ¬ã€‚

### ç”Ÿæˆä¸€ä¸ªæ–°çš„ app

[create-probot-app][create-probot-app] æ˜¯å¼€å§‹æ„å»ºä¸€ä¸ªæ–°çš„ app çš„æœ€ä½³æ–¹å¼ã€‚å®ƒå°†ç”Ÿæˆä¸€ä¸ªæ–°çš„åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­åŒ…å«ä½ æ‰€éœ€è¦çš„ä¸€åˆ‡ï¼Œä»¥å¼€å§‹å¹¶åœ¨ç”Ÿäº§ä¸­è¿è¡Œä½ çš„åº”ç”¨ç¨‹åºã€‚

è¿è¡Œä¸‹é¢çš„å‘½ä»¤ç”Ÿæˆä¸€ä¸ªé¡¹ç›®ï¼š

```sh
$ npx create-probot-app my-first-app
```

è¯¥å‘½ä»¤ä¼šé—®ä¸€ç³»åˆ—å…³äºä½ çš„ app çš„é—®é¢˜ï¼Œçœ‹èµ·æ¥å°±åƒï¼š

```sh
Let's create a Probot app!
? App name: my-first-app
? Description of app: A 'Hello World' GitHub App built with Probot.
? Author's full name: Katie Horne
? Author's email address: katie@auth0.com
? GitHub user or org name: khorne3
? Repository name: my-first-app
? Which template would you like to use? (Use arrow keys)
â¯ basic-js
  basic-ts (use this one for TypeScript support)
  checks-js
  git-data-js
  deploy-js

Finished scaffolding files!

Installing dependencies. This may take a few minutes...

Successfully created my-first-app.

Begin using your app with:
  cd my-first-app
  npm start

View your app's README for more usage instructions.

Visit the Probot docs:
  https://probot.github.io/docs/

Get help from the community:
  https://probot.github.io/community/

Enjoy building your Probot app!
```

åˆ›å»ºçš„æœ€é‡è¦çš„æ–‡ä»¶æ˜¯ `index.js`ï¼ˆä½ çš„ app ä»£ç æ‰€åœ¨çš„ä½ç½®ï¼‰å’Œ `package.json`ï¼ˆä½¿ä½ çš„ app æˆä¸ºæ ‡å‡† [npm module][npm-module]ï¼‰ã€‚

### æœ¬åœ°è¿è¡Œ app

ç°åœ¨ä½ å·²ç»å‡†å¤‡å¥½åœ¨æœ¬åœ°è¿è¡Œ app äº†ã€‚è¿è¡Œ `npm start` æ¥å¼€å¯ä¸€ä¸ª server å§ï¼š

> æ³¨æ„ï¼šå¦‚æœä½ é€‰æ‹©äº† TypeScript æ¨¡æ¿ï¼Œè¯·ç¡®ä¿æ‰§è¡Œäº† `npm run build`ï¼

```sh
$ yarn start
yarn run v1.22.10
$ probot run ./lib/index.js
INFO (server): Running Probot v11.3.0 (Node.js: v14.15.5)
INFO (server): Forwarding https://smee.io/dz7D1zur24cGNj7 to http://localhost:3000/
INFO (server): Listening on http://localhost:3000
INFO (server): Connected
```

### é…ç½® GitHub App

ä¸‹åˆ—æ˜¯è‡ªåŠ¨é…ç½® GitHub App çš„æ­¥éª¤ï¼š

1. åœ¨æœ¬åœ°å‘½ä»¤è¡Œä¸­æ‰§è¡Œ `npm start`ã€‚
2. è®¿é—® http://localhost:3000 æŸ¥çœ‹ä¸‹ä¸€æ­¥ã€‚
3. ä½ ä¼šçœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„é¡µé¢ã€‚

![ç´«ç«¹](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0e1601ae833f47a1815d79cb1dea2e6f~tplv-k3u1fbpfcp-zoom-1.image)

4. ç‚¹å‡» **Register a GitHub App** æŒ‰é’®ç»§ç»­ã€‚
5. æ¥ç€ï¼Œä½ éœ€è¦ç»™ä½ çš„ App å–ä¸€ä¸ªæ²¡æœ‰è¢«å ç”¨çš„åå­—ï¼Œæ³¨æ„ï¼šå¦‚æœä½ çœ‹åˆ°ç±»ä¼¼ `Name is reserved for the account @tuya` çš„æç¤ºï¼Œè¿™æ„å‘³ç€ä½ ä¸èƒ½ä½¿ç”¨å·²å­˜åœ¨çš„ GitHub organization çš„åå­—ä½œä¸º app çš„åå­—ï¼ˆé™¤éä½ æ˜¯è¯¥ç»„ç»‡çš„ ownerï¼‰

## GitHub Release æ—¶ `npm publish`

![ç´«ç«¹](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a5e7c791feb140cbb537a79c89450842~tplv-k3u1fbpfcp-zoom-1.image)

å®ç° GitHub CI è‡ªåŠ¨å‘å¸ƒ NPM åŒ…ï¼Œä¸»è¦æ˜¯ä¸ºäº†åˆç†ç®¡ç†å¯¹å¤– npm å‘å¸ƒæƒé™ã€‚è€Œæ¯”è¾ƒé€šç”¨çš„å‘å¸ƒæ—¶æœºæ˜¯åœ¨ GitHub release æ—¶ã€‚åŸºäºä¸Šé¢æµç¨‹å›¾çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡º released çŠ¶æ€æ—¶æ‰§è¡Œ `npm publish` æœ€åˆé€‚ã€‚

æˆ‘ä»¬å®ç°çš„å…·ä½“é€»è¾‘æ˜¯ï¼Œå½“ Probot app ç›‘å¬åˆ° `release.released` äº‹ä»¶æ—¶ï¼Œå¤„ç†å‘å¸ƒå‰çš„æ“ä½œã€‚é‡è¦çš„æ˜¯æˆ‘ä»¬éœ€è¦æ ¹æ® `package.json` ä¸­çš„ `version` å­—æ®µåŒ¹é…å‡º tagï¼Œæ¯”å¦‚ï¼š

- 1.0.0ï¼štag ä¸º latest çš„ 1.0.0
- 1.0.0-beta.0ï¼štag ä¸º beta çš„ 1.0.0-beta.0
- 1.0.0-alpha.0ï¼štag ä¸º alpha çš„ 1.0.0-alpha

## NPM è‡ªåŠ¨å‘å¸ƒå®ç°åŸç†

å‘å¸ƒä¹‹å‰æˆ‘ä»¬éœ€è¦æ‹‰å–ä»“åº“ä»£ç ã€å–å‡ºç‰ˆæœ¬å’Œ tagã€è®¾ç½® NPM publish Token ç­‰å·¥ä½œã€‚å…ˆä¸Šæ ¸å¿ƒä»£ç ï¼Œåé¢æˆ‘ä»¬è¯¦ç»†è§£æã€‚

```js
app.on('release.released', async context => {
  if (!isTuya(context)) return;
  app.log('npm publishing');
  const { repository: repo } = context.payload;
  const downloadDefaultBranch = `${repo.full_name}#${context.payload.release.tag_name}`;
  const downLoadTempDir = `${os.tmpdir()}/${repo.full_name}`;
  await download(downloadDefaultBranch, downLoadTempDir);
  const { version, scripts } = require(`${downLoadTempDir}/package.json`);
  const tag = /^\d\.\d\.\d-(.*)\.\d$/.exec(version)
    ? /^\d\.\d\.\d-(.*)\.\d$/.exec(version)[1]
    : 'latest';
  // å¦‚æœæœ‰ build è„šæœ¬åˆ™å…ˆæ‰§è¡Œ build è„šæœ¬
  if (scripts.build) {
    await execSh(`cd ${downLoadTempDir} && npm install && npm run build`);
  }
  try {
    const result = await npmPublish({
      package: `${downLoadTempDir}/package.json`,
      token: process.env.NPM_AUTH_TOKEN,
      registry: 'https://registry.npmjs.org/',
      tag,
    });
    if (result.type === 'none') {
      app.log.error(
        `You can't publish duplicate version ${result.package}@${result.version}`,
      );
    }
  } catch (error) {
    app.log.error(error);
  }
});
```

### NPM Publish Token

#### ç”³è¯· NPM Publish Token

**1. è®¿é—® npmjs.com è¿›å…¥ Access Tokens é¡µé¢**

![ç´«ç«¹](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2e077e9f9d0a4dc8bde0a24e121461c3~tplv-k3u1fbpfcp-zoom-1.image)

**2. ç‚¹å‡» Generate New Token æŒ‰é’®**

![ç´«ç«¹](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/82e09021f85c413d80ac77ed3df6746e~tplv-k3u1fbpfcp-zoom-1.image)

**3. Token ç±»å‹é€‰æ‹© Publish**

![ç´«ç«¹](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/256574d0e063410aa50c85d469346809~tplv-k3u1fbpfcp-zoom-1.image)

#### ä¿è¯ NPM Publish Token å®‰å…¨æ€§

NPM Token æ˜¯ä¸èƒ½è¢«åˆ«äººçœ‹åˆ°çš„ï¼Œä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œé¦–å…ˆé¡¹ç›®éœ€è¦è®¾ç½®ä¸ºç§æœ‰çš„ï¼Œç„¶åå°† Token æ”¾åˆ° `.env` ä¸­ï¼Œé€šè¿‡ `process.env.NPM_AUTH_TOKEN` è·å–ã€‚å¦å¤–è°¨è®°ä¸è¦åœ¨æ—¥å¿—ä¸­æ‰“å°ç¯å¢ƒå˜é‡ã€‚

#### ä¿è¯ GitHub App å®‰å…¨æ€§

å¦‚æœæŠŠ GitHub App å‘å¸ƒä¸º public çš„ï¼Œé‚£ä¹ˆä»»ä½•ä»“åº“éƒ½å¯ä»¥å®‰è£…è¯¥åº”ç”¨ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚è§£å†³åŠæ³•æœ‰ä¸¤ä¸ªï¼Œä¸€æ˜¯å°†åº”ç”¨æ³¨å†Œä¸º private ç±»å‹çš„ï¼ŒäºŒæ˜¯åœ¨ç›‘å¬å›è°ƒä¸­åˆ¤æ–­æ˜¯å¦æ˜¯å…è®¸çš„ç»„ç»‡æˆ–è€…ç”¨æˆ·ã€‚æˆ‘é€‰æ‹©çš„æ˜¯ç¬¬äºŒç§æ–¹æ¡ˆï¼Œæ ¡éªŒå‡½æ•°å¦‚ä¸‹ï¼š

```js
const isTuya = context => {
  const { full_name } = context.payload.repository;
  return full_name.startsWith('youngjuning') || full_name.startsWith('tuya');
};
```

### ä¸‹è½½æºç 

æˆ‘ä»¬é€‰æ‹©äº† download-git-repo ä¸‹è½½ git ä»“åº“ï¼Œä½†æ˜¯è¯¥ä»“åº“ä¸æ”¯æŒ Promiseï¼Œæˆ‘ä»¬åšä¸€ä¸‹ç®€å•çš„æ”¹é€ ï¼š

```js
const download = require('download-git-repo');

module.exports = (repo, tempDir) => {
  return new Promise((resolve, reject) => {
    download(repo, tempDir, err => {
      if (err) {
        reject(err);
      } else {
        resolve(null);
      }
    });
  });
};
```

### npmPublish

æˆ‘ä»¬é€‰æ‹©äº† @jsdevtools/npm-publish æ‰§è¡Œå‘å¸ƒåŠ¨ä½œï¼Œè¯¥ä»“åº“é™¤äº†ç¼–ç¨‹è°ƒç”¨å¤–ï¼Œè¿˜å¯ä»¥ä½œä¸º GitHub Action å’Œå‘½ä»¤è¡Œå·¥å…·ä½¿ç”¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦ç”¨æ­£åˆ™å–å‡ºæˆ‘ä»¬è¦å‘å¸ƒçš„ tagï¼š

```js
const tag = /^\d\.\d\.\d-(.*)\.\d$/.exec(version)
  ? /^\d\.\d\.\d-(.*)\.\d$/.exec(version)[1]
  : 'latest';
```

### lerna publish

lerna ç®¡ç†ç‰ˆæœ¬ç”±äºæ˜¯ä¸€æ¬¡å¯èƒ½å‘å¸ƒå¤šä¸ªä»“åº“ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨ä¸Šé¢æåˆ°çš„å‘å¸ƒæµç¨‹ã€‚é’ˆå¯¹ lernaï¼Œæˆ‘è®¾è®¡çš„å‘å¸ƒæµç¨‹æ˜¯ç›‘å¬åˆ° push åŠ¨ä½œåå–æœ€æ–°çš„ä¸€æ¡ commitï¼ŒåŒ¹é…æ˜¯å¦åŒ…å« `chore(release): publish`ã€‚å…·ä½“åŸç†å¦‚ä¸‹ï¼š

1. åˆ¤æ–­ push åˆ†æ”¯æ˜¯å¦æ˜¯ä¸»åˆ†æ”¯ä¸”æäº¤ä¿¡æ¯åŒ…å« `chore(release): publish`
2. å› ä¸ºæ˜¯ lerna publishï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ simple-git è¿™ä¸ªåº“ clone é¡¹ç›®ã€‚
3. ç”±äº lerna publish [ä¸æ”¯æŒ token](https://github.com/lerna/lerna/issues/2404)ï¼Œæˆ‘ä»¬é‡‡ç”¨å°† `//registry.npmjs.org/:_authToken=${process.env.NPM_AUTH_TOKEN}` å†™å…¥ `.npmrc` çš„æ–¹å¼å®Œæˆå¸¦ token çš„å‘å¸ƒã€‚
4. æœ€åï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ `from-git` çš„æ–¹å¼æ‰§è¡Œ `lerna publish`ï¼Œ`from-git` çš„åœºæ™¯ä¾¿æ˜¯æœ¬åœ°æ‰§è¡Œ `lerna version`ï¼Œåœ¨ CI ä¸­æ‰§è¡Œ `lerna publish`ã€‚

å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š

```js
app.on('push', async context => {
  if (!isTuya(context)) return;
  if (
    context.payload.ref.indexOf(context.payload.repository.default_branch) !==
      -1 &&
    context.payload.head_commit.message.indexOf('chore(release): publish') === 0
  ) {
    app.log('push event');
    execSh(`git --version`);
    const { repository: repo } = context.payload;
    const cloneTempDir = `${os.tmpdir()}/${repo.full_name}`;
    try {
      await git.clone(repo.clone_url, cloneTempDir);
      const { devDependencies } = require(`${cloneTempDir}/package.json`);
      if (devDependencies['lerna']) {
        app.log('lerna publishing');
        await execSh(
          `cd ${cloneTempDir} && echo //registry.npmjs.org/:_authToken=${process.env.NPM_AUTH_TOKEN} > .npmrc`,
        );
        await execSh(
          `cd ${cloneTempDir} && npm install && npm run build && ./node_modules/.bin/lerna publish from-git --yes --no-verify-access`,
        );
      }
      await execSh(`rm -rf ${cloneTempDir}`);
    } catch (error) {
      await execSh(`rm -rf ${cloneTempDir}`);
    }
  }
});
```

## Glitch éƒ¨ç½²

å¦‚æœä½ æœ‰è‡ªå·±çš„æœåŠ¡å™¨ï¼Œå¯ä»¥ç›´æ¥å°†æœºå™¨äººç¨‹åºéƒ¨ç½²åˆ°è‡ªå·±çš„æœåŠ¡å™¨ã€‚æˆ‘è¿™é‡Œä½¿ç”¨å®˜æ–¹æ¨èçš„ Glitch æœåŠ¡éƒ¨ç½²ã€‚Glitch å¯ä»¥å…è´¹æ‰˜ç®¡ node åº”ç”¨å¹¶ä¸”ç›´æ¥åœ¨æµè§ˆå™¨ä¸­ç¼–è¾‘ä»–ä»¬ã€‚å¯¹äºç®€å•çš„åº”ç”¨å®Œå…¨å¤Ÿäº†ã€‚

1. æ³¨å†Œå¹¶åœ¨ [Glitch](https://glitch.com/) æ–°å»ºé¡¹ç›®ï¼Œé€‰æ‹© **Import from GitHub**ï¼Œå¼¹çª—å†™ä¸Šåº”ç”¨ github åœ°å€ï¼Œæˆ–è€…ä½¿ç”¨ https://github.com/behaviorbot/new-issue-welcome ä½œä¸ºæ¨¡æ¿å¯¼å…¥åå†å°†è‡ªå·±çš„ä»£ç å¤åˆ¶è¿‡æ¥ã€‚
2. æ‰“å¼€ `.env` æ–‡ä»¶ä½¿ç”¨ä»¥ä¸‹å†…å®¹æ›¿ä»£ï¼š

```
APP_ID=<your app id>
WEBHOOK_SECRET=<your app secret>
PRIVATE_KEY_PATH=<your private_key>
NODE_ENV=production
NPM_AUTH_TOKEN=3c2c104e-9f1f-4fc5-903e-726610b75ce1
INPUT_TOKEN=
```

4. å°† glitch é“¾æ¥è®¾ç½®ä¸º GitHub App çš„ webhook åœ°å€å³å¯ï¼Œä¹‹åæ›´æ–°ä»£ç ï¼Œglitch ä¼šè‡ªåŠ¨æ›´æ–°éƒ¨ç½²ã€‚

## æƒé™

Probot App çš„åˆå§‹æƒé™åœ¨ `app.yml` æ–‡ä»¶ä¸­ï¼Œå¦‚æœ App å·²ç»åˆ›å»ºäº†ï¼Œåˆæƒ³è¦æ›´æ–°æƒé™ï¼Œå¯ä»¥åœ¨ https://github.com/settings/apps ä¸­æ›´æ–°ã€‚æˆ‘æ‰€ç”¨çš„æƒé™é…ç½®è¯·ç‚¹å‡» [app.yml](https://glitch.com/edit/#!/tuya-robot?path=app.yml%3A119%3A0) æŸ¥çœ‹ã€‚

[probot]: https://probot.github.io/
[github apps]: https://docs.github.com/en/developers/apps/about-apps
[web æŒ‚é’©äº‹ä»¶å’Œæœ‰æ•ˆè´Ÿè½½]: https://docs.github.com/cn/developers/webhooks-and-Ã§events/webhooks/webhook-events-and-payloads
[marketplace-getting-started]: https://docs.github.com/en/marketplace/getting-started
[eslint-disable]: https://probot.github.io/apps/eslint-disable/
[dco]: https://probot.github.io/apps/dco/
[issue-check]: https://probot.github.io/apps/issue-check/
[pull]: https://probot.github.io/apps/pull/
[featured-apps]: https://probot.github.io/apps/
[github-probot-app-topics]: https://github.com/search?q=topic%3Aprobot-app&type=Repositories
[node-modules]: https://nodejs.org/api/modules.html
[probot-class]: https://probot.github.io/api/latest/classes/probot.html
[webhooks]: https://probot.github.io/docs/webhooks/
[github-api]: https://probot.github.io/docs/github-api/
[create-probot-app]: https://github.com/probot/create-probot-app
[npm-module]: https://docs.npmjs.com/files/package.json

> æœ¬æ–‡é¦–å‘äºã€Œ[ç´«ç«¹çš„å®˜æ–¹ç½‘ç«™](https://youngjuning.js.org/)ã€ï¼ŒåŒæ­¥äºå…¬ä¼—å·ã€Œ[ç´«ç«¹æ—©èŒ¶é¦†](https://cdn.jsdelivr.net/gh/youngjuning/images/20210418112129.jpeg)ã€å’Œã€Œ[æ˜é‡‘ä¸“æ ](https://juejin.cn/user/325111174662855)ã€ã€‚
